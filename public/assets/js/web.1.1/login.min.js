$(document).ready(function($){

var URLactual = window.location;

if (localStorage){
    if(localStorage.getItem('URLSERVER') !== undefined && localStorage.getItem('URLSERVER')){
    	if(localStorage.getItem('TOKENSESSION') !== undefined && localStorage.getItem('TOKENSESSION')){

    	var ruta = localStorage.getItem('URLSERVER');
      var rutainicio = localStorage.getItem('URLINICIO');      
    	var tokensession = localStorage.getItem('TOKENSESSION');
    	window.location.href = ruta+"paciente/"+rutainicio;

    	}
    }else{
    localStorage.setItem('URLSERVER', URLactual);	
    }
}

});

function random() {
    return Math.random().toString(36).substr(2);
};
 
function token() {
    return random() + random();
};

function BtnAcceso(){

var ruta = localStorage.getItem('URLSERVER');
var valorusuario = $("#valorusuario").val();
var valorpassword = $("#valorpassword").val();
var tokensession = token();

if (valorusuario.trim() === '') {
$('#valorusuario').css('border','2px solid #B83737');
}else if (valorpassword.trim() === '') {
$('#valorpassword').css('border','2px solid #B83737');
}else{

	var parametros = {
	"valor_usuario" : valorusuario,
	"valor_password" : valorpassword,
	"valor_token" : tokensession
	};


  $.ajax({
  data:  parametros,
  url:   ruta + 'app/modelo/acceso/login-usuario.php',
  type:  'post',
  beforeSend: function() {
   $("#resultadoDiv").html('<div class="text-center pt-2"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div></div>');
  },
  complete: function(){

  },
  success:  function (response) {

   if (response == 0) {
   $("#resultadoDiv").html('<div class="text-center text-danger mt-3">El usuario o contrase√±a son incorrectos.</div>');
   }else if (response == 1) {
   localStorage.setItem("TOKENSESSION", tokensession);
   localStorage.setItem('URLINICIO', "clinica");  
   setCookie("TOKENSESSION", tokensession, 365);
   window.location.href = ruta+"paciente/clinica";     
   }else if (response == 2) {
   localStorage.setItem("TOKENSESSION", tokensession);
   localStorage.setItem('URLINICIO', "home");
   setCookie("TOKENSESSION", tokensession, 365);
   window.location.href = "home";  
   }

    }
    });

}

}

function setCookie(cname, cvalue, exdays) {
  var d = new Date();
  d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
  var expires = "expires="+d.toUTCString();
  document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
}